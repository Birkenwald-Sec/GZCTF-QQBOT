# GZCTF_BOT

ä¸€æ¬¾é€‚ç”¨äºŽGZ::CTFå¹³å°å¯æŽ§åˆ¶çš„QQæ’­æŠ¥BOTï¼Œç”±äºŽå¹³å°çš„APIè°ƒç”¨ååˆ†æ–¹ä¾¿ï¼Œä½¿ç”¨BOTçš„å¯ä¼˜åŒ–çš„åŠŸèƒ½ç‚¹æœ‰å¾ˆå¤šã€‚GZtime nb.jpgï¼ï¼ï¼

### åŠŸèƒ½ðŸ§€

- Bloodæ’­æŠ¥ï¼ˆFirst Bloodã€Second Bloodã€Third Bloodï¼‰
- é¢˜ç›®ä¸Šæ–°æ’­æŠ¥
- é¢˜ç›®æç¤ºæ›´æ–°æ’­æŠ¥
- èµ›äº‹å…¬å‘Šæ’­æŠ¥
- æ’­æŠ¥å¯æŽ§å¼€å…³
- å¤šæ¯”èµ›åŒæ—¶ç›‘æŽ§
- å¯æ–¹ä¾¿çš„ä¸ºç”¨æˆ·é…ç½®æƒé™
- å¯æ–¹ä¾¿çš„è®¾ç½®æ¶ˆæ¯å‘é€ç»ˆç‚¹
- å®šåˆ¶åž‹æ¶ˆæ¯æ¨¡æ¿ï¼ˆè®©ä½ çš„å…¬å‘Šä¸Žä¼—ä¸åŒ qwqï¼‰
- æ‹¥æœ‰è¾ƒå¥½çš„æ‹“å±•æ€§

### ä½¿ç”¨æ•™ç¨‹ ðŸš—

1. æ ¹æ®éƒ¨ç½²è¿‡ç¨‹å®‰è£…Nonebot2ã€go-cqhttp çš„ç›¸å…³ä¾èµ–ï¼›
2. ä½¿ç”¨gitæŒ‡ä»¤æ‹‰å–æœ¬ä»“åº“çš„æºç æ”¾ç½®ä½ æ‰€æŒ‡å®šçš„ç›®å½•ï¼›
3. ä¿®æ”¹éƒ¨ç½²è¿‡ç¨‹ä¸­çš„æŒ‡å®šå‚æ•°ï¼Œæ¯”å¦‚QQå·ï¼Œå¹³å°åœ°å€ç­‰éœ€è¦è‡ªå®šä¹‰çš„å‚æ•°ï¼›
4. ç§»åŠ¨åˆ°**go-cqhttp**ç›®å½•ä½¿ç”¨`nohup go-cqhttp >/dev/null 2>&1 &`æ”¾åœ¨åŽå°è¿è¡Œï¼Œå¦‚æžœå®žåœ¨è°ƒè¯•è¿‡ç¨‹ä¸­å°±ä¸éœ€è¦æ”¾ç½®åŽå°è¿è¡Œï¼›
5. å›žåˆ°**bot.py**æ‰€åœ¨ç›®å½•ï¼Œä½¿ç”¨ `nohup python3 bot.py >/dev/null 2>&1 &`åŽå°è¿è¡Œbot.py;
6. ç”±æŒ‡å®šçš„ç™½åå•ç”¨æˆ·å¯¹QQ-botç”¨æˆ·å‘å‡º`/open`æŒ‡ä»¤å¼€å¯botï¼Œé…ç½®æ— è¯¯å°†ä¼šæ”¶åˆ°â€œæ’­æŠ¥å·²ç»å¼€å¯â€çš„å›žå¤ï¼›
7. å›žåˆ°æœ¬é¡¹ç›®ç‚¹ä¸€ä¸ªstarï¼ŒåŽç»­å°†é™†ç»­å¼€å‘å‡ºæ–°åŠŸèƒ½ï¼Œå°½æƒ…æœŸå¾…ï¼

ä½¿ç”¨ç™½åå•ç”¨æˆ·å‘æœºå™¨äººå‘é€ /help æˆ–è€… /å¸®åŠ©æ¥æŸ¥çœ‹å¸®åŠ©ï¼ˆåŠŸèƒ½å¾ˆå°‘Orzï¼‰

### éƒ¨ç½²è¿‡ç¨‹ ðŸš€

æ­¤æœåŠ¡ä½¿ç”¨ **Nonebot2 + go-cqhttp** æž¶æž„å®Œæˆæ­å»ºï¼Œéœ€è¦ä¸€ç‚¹ç‚¹pythonåŸºç¡€ã€‚

#### æ­å»ºgo-cqhttp ðŸ¤–

é¦–å…ˆå‰å¾€ [go-cqhttp ä¸‹è½½é¡µé¢](https://github.com/Mrs4s/go-cqhttp/releases) ä¸‹è½½å¹¶å®‰è£… **`go-cqhttp`** æœ€æ–°ç‰ˆæœ¬

ä½¿ç”¨ **go-cqhttp** è¿›è¡Œåˆå§‹åŒ–ï¼Œé€‰æ‹©å¦‚ä¸‹

![æˆªå›¾](https://github.com/Birkenwald-Sec/GZCTF-BOT/assets/61536775/c4796e35-9592-4481-b1ef-4ad42c59c70e)

åˆå§‹åŒ–åŽï¼Œæ‰“å¼€åŒç›®å½•ä¸‹çš„ `config.yml` æ–‡ä»¶ï¼Œé…ç½®å¥½è‡ªå·±çš„ç™»å½•ä»¤ç‰Œï¼Œå¯†ç å¯é€‰æ‹©ä¸ºç©ºï¼Œç„¶åŽä½¿ç”¨æ‰«ç è¿›è¡Œç™»å½•

![æˆªå›¾](https://github.com/Birkenwald-Sec/GZCTF-BOT/assets/61536775/375b00a7-78c3-45d3-90a6-d9759793eedc)

åŒæ—¶ï¼Œåœ¨ `config.yml` æ–‡ä»¶ä¸­æ‰¾åˆ° `ws-server` è®¾ç½®é¡¹ï¼Œè¿›è¡Œå¦‚ä¸‹è®¾ç½®

![æˆªå›¾](https://github.com/Birkenwald-Sec/GZCTF-BOT/assets/61536775/8a8aa999-845e-4c78-aaf1-dfdd67369ff2)

æ‰“å¼€åŒç›®å½•ä¸‹çš„ `device.json` å°† **`protocol`** é¡¹æ›´æ”¹ä¸º2ï¼ˆAndroid Watchåè®®ï¼‰

![æˆªå›¾](https://github.com/Birkenwald-Sec/GZCTF-BOT/assets/61536775/ffce8a38-3bef-4efe-9351-9c12182aa8f3)

æœ€åŽå†æ¬¡ä½¿ç”¨ `go-cqhttp` æŒ‡ä»¤ï¼Œä½¿ç”¨äºŒç»´ç å³å¯ç™»å½•è‡ªå·±çš„qqï¼Œå¹¶å®žçŽ°å‘½ä»¤è¡ŒæŽ¥æ”¶qqä¿¡æ¯

ä¹Ÿå¯ä»¥ç›´æŽ¥ä½¿ç”¨ `go-cqhttp` æä¾›çš„APIå®žçŽ°æ¶ˆæ¯çš„å‘é€ä¸ŽæŽ¥æ”¶ï¼Œè¯¦ç»†è¯·å‰å¾€ [go-cqhttp å®˜æ–¹æ–‡æ¡£](https://docs.go-cqhttp.org/api/#%E5%9F%BA%E7%A1%80%E4%BC%A0%E8%BE%93)

#### éƒ¨ç½²Nonebot2 ðŸ±â€ðŸ‰

é¦–å…ˆå®‰è£…ç›¸å…³ä¾èµ–
```
pip install nb-cli
pip install nonebot2
pip install nonebot-adapter-cqhttp
pip install nonebot2[fastapi]
nb plugin install nonebot_plugin_apscheduler
```
ç„¶åŽä½¿ç”¨gitæ‹‰å–GZCTF-BOTé¡¹ç›®åˆ°ä½ æŒ‡å®šçš„æ–‡ä»¶å¤¹ä¸­

![æˆªå›¾](https://github.com/Birkenwald-Sec/GZCTF-BOT/assets/61536775/ba18028c-4ddc-47b6-abf2-c9ff10d3cb60)

è®¾ç½® **GZCTF-BOT/src/plugin/gzctf-plugin/config.py** ä¸­çš„å¿…é€‰é¡¹ï¼Œç„¶åŽä½¿ç”¨ python å¯åŠ¨ bot.py å³å¯

#### config.py è®¾ç½® ðŸ”§

- "WHITE_LIST": è§„å®šæŒ‡ä»¤ç›‘å¬æ¶ˆæ¯çš„æ¥æº
  - "key": å¯è§¦å‘æŒ‡ä»¤çš„ç”¨æˆ·çš„è´¦å·
  - "value"
    - "type": "private", "group", "all"
      - "private": è¡¨ç¤ºç›‘å¬å•ä¸ªç”¨æˆ·ï¼Œè®¾ç½®æ­¤é¡¹åˆ™åŽç»­ `group` é¡¹æ— æ•ˆ
      - "group": è¯¥ç±»åž‹è¡¨ç¤ºç›‘å¬ç¾¤ç»„æ¶ˆæ¯ï¼Œ è®¾ç½®æ­¤é¡¹åˆ™å¿…é¡»è®¾ç½®åŽç»­çš„ `group` é¡¹æ¥æŒ‡æ˜Žè¢«ç›‘å¬ç¾¤çš„ç¾¤å·
      - "all": è¯¥ç±»åž‹è¡¨ç¤ºæ—¢ç›‘å¬ç§äººä¿¡æ¯åˆç›‘å¬ç¾¤ç»„æ¶ˆæ¯ï¼Œè®¾ç½®æ­¤é¡¹åˆ™å¿…é¡»è®¾ç½®åŽç»­çš„ `group` é¡¹
      - "æ³¨": æ‰€ç›‘å¬çš„ç§äººç”¨æˆ·è´¦å·æ˜¯ä¸Šé¢æ‰€è®¾ç½® "key" å­—æ®µ
    - "group": åˆ—è¡¨ï¼Œå…¶ä¸­æ·»åŠ è¢«ç›‘å¬ç¾¤çš„ç¾¤å·ï¼Œéœ€ä½¿ç”¨å­—ç¬¦ä¸²æ ¼å¼ 
``` python
# WHITE_LIST æ ‡å‡†ç¤ºä¾‹
"WHITE_LIST" : {
            "1234567890": {"type": "all","group":['518041028']},
            "2236548876": {"type": "private"}
        }
```

- "ENDPOINT": ç”¨æ¥æŒ‡æ˜Žæ¶ˆæ¯æŽ¥æ”¶æ–¹
  - "group_id": åˆ—è¡¨ï¼ŒæŒ‡æ˜ŽæŽ¥æ”¶ç¾¤ç¾¤å·
  - "user_id": åˆ—è¡¨ï¼ŒæŒ‡æ˜ŽæŽ¥æ”¶ç”¨æˆ·çš„è´¦å·

``` python
# ENDPOINT æ ‡å‡†ç¤ºä¾‹
"ENDPOINT" : {
            'group_id': [518041028],
            'user_id': [1234567890]
        }
```

- "BC_FRESH_TIME": æ’­æŠ¥åˆ·æ–°é¢‘çŽ‡ï¼Œå¯ç©ºï¼Œé»˜è®¤20ç§’ä¸€æ¬¡

- "GAMEMONITORED": GZCTFæ¯”èµ›æ ‡é¢˜ï¼Œå¯ä½¿ç”¨åˆ—è¡¨æŒ‡å®šå¤šä¸ª

``` python
# GAMEMONITORED æ ‡å‡†ç¤ºä¾‹
"GAMEMONITORED" : ["myCtf1","myCtf2","myCtf3",...]
```

![æˆªå›¾](https://github.com/Birkenwald-Sec/GZCTF-BOT/assets/61536775/bb5bfe8d-5248-46d7-a7ed-a30acb7839bb)

- "BC_MESSAGE_TEMPLATE": æ’­æŠ¥æ¶ˆæ¯æ¨¡æ¿
  - "{type}": è¡¨ç¤ºæ¶ˆæ¯ç§ç±»
  - "{time}": è¡¨ç¤ºæ¶ˆæ¯å‘ç”Ÿæ—¶é—´
  - "{content}": è¡¨ç¤ºæ¶ˆæ¯å†…å®¹
  - "{year}": æ¶ˆæ¯æ—¶é—´ - å¹´
  - "{month}": æ¶ˆæ¯æ—¶é—´ - æœˆ
  - "{day}": æ¶ˆæ¯æ—¶é—´ - æ—¥
  - "{hour}": æ¶ˆæ¯æ—¶é—´ - æ—¶
  - "{minute}": æ¶ˆæ¯æ—¶é—´ - åˆ†
  - "{second}": æ¶ˆæ¯æ—¶é—´ - ç§’
  - "{game_title}": æ¯”èµ›æ ‡é¢˜
  - "{game_id}": æ¯”èµ›idå·
  - "æ³¨": å¯ä»Ž [CQç ](https://docs.go-cqhttp.org/cqcode/#%E8%BD%AC%E4%B9%89) èŽ·å–è¡¨æƒ…å­—ç¬¦ä½¿ç”¨è¯´æ˜Ž

``` python
# BC_MESSAGE_TEMPLATE æ ‡å‡†ç¤ºä¾‹
"ç±»åž‹ï¼š{type} äºŽ {game_title}\nå†…å®¹ï¼š {content}\næ—¶é—´ï¼š {month}-{day} {time}"
```

![image](https://github.com/Birkenwald-Sec/GZCTF-QQBOT/assets/61536775/1941fcff-3a64-4e22-8eef-6ff9f708cf7f)

![image](https://github.com/Birkenwald-Sec/GZCTF-QQBOT/assets/61536775/d998f09a-d3e3-4528-b23b-ddea0f784050)

- "GZCTF_USER": GZCTFå¹³å°ç®¡ç†å‘˜è´¦æˆ·

- "GZCTF_USER_PASS": GZCTFå¹³å°ç®¡ç†å‘˜å¯†ç 

- "BASEURL": gzctfå¹³å°åœ°å€ï¼Œä¾‹ï¼šhttps://www.gzctf.com/

è®¾ç½®å®Œä¸Šè¿°å‚æ•°åŽ ä½¿ç”¨ pythonè¿è¡Œ bot.pyæ–‡ä»¶å³å¯ï¼Œå¦‚æžœéœ€è¦è®¾ç½®ä¸ºåŽå°è¿è¡Œå¯ä»¥ä½¿ç”¨ `nohup python3 bot.py >/dev/null 2>&1 &`
